<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ if .Title }}{{ .Title }} | {{ end }}{{ .Site.Title }}</title>
    <meta name="description" content="{{ if .Description }}{{ .Description }}{{ else }}{{ .Site.Params.description }}{{ end }}">
    
    <!-- Critical CSS inlined for performance -->
    <style>
        {{ partial "critical-css.html" . | safeCSS }}
    </style>
    
    <!-- Non-critical CSS loaded asynchronously -->
    <link rel="preload" href="/css/main.css" as="style" onload="this.onload=null,this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/css/main.css"></noscript>
    
    <!-- Preconnect to external resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Font loading with display swap for performance -->
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" href="/boo.svg" type="image/svg+xml">
    <link rel="alternate icon" href="/favicon.ico">
    
    <!-- Open Graph / Social Media -->
    <meta property="og:title" content="{{ if .Title }}{{ .Title }}{{ else }}{{ .Site.Title }}{{ end }}">
    <meta property="og:description" content="{{ if .Description }}{{ .Description }}{{ else }}{{ .Site.Params.description }}{{ end }}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ .Permalink }}">
    <meta property="og:site_name" content="{{ .Site.Title }}">
    {{ $pageTitle := .Title | lower }}
    {{ $ogImage := printf "og-image-%s.png" $pageTitle }}
    
    <meta property="og:image" content="{{ .Site.BaseURL }}{{ $ogImage }}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="{{ if .Title }}{{ .Title }}{{ else }}{{ .Site.Title }}{{ end }} - {{ if .Description }}{{ .Description }}{{ else }}{{ .Site.Params.description }}{{ end }}">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ if .Title }}{{ .Title }}{{ else }}{{ .Site.Title }}{{ end }}">
    <meta name="twitter:description" content="{{ if .Description }}{{ .Description }}{{ else }}{{ .Site.Params.description }}{{ end }}">
    <meta name="twitter:image" content="{{ .Site.BaseURL }}{{ $ogImage }}">
    
    <!-- Additional Meta -->
    <meta name="description" content="{{ if .Description }}{{ .Description }}{{ else }}{{ .Site.Params.description }}{{ end }}">
    <meta name="author" content="{{ .Site.Title }}">
</head>
<body class="{{ block "body-class" . }}{{ end }}">
    {{ block "main" . }}{{ end }}
    
    <!-- Desktop-only telemetry script -->
    <script>
        (function() {
            'use strict';
            
            // Only run on desktop
            if (window.innerWidth < 1024) return;
            
            function updateMetrics() {
                const perf = performance;
                const timing = perf.timing;
                const now = Date.now();
                
                // Load time (total page load)
                const loadTime = timing.loadEventEnd - timing.navigationStart;
                if (loadTime > 0) {
                    document.getElementById('load-time').textContent = loadTime + 'ms';
                }
                
                // DOM ready time
                const domTime = timing.domContentLoadedEventEnd - timing.navigationStart;
                if (domTime > 0) {
                    document.getElementById('dom-time').textContent = domTime + 'ms';
                }
                
                // First paint time (if available)
                if ('getEntriesByType' in perf) {
                    const paintEntries = perf.getEntriesByType('paint');
                    const firstPaint = paintEntries.find(entry => entry.name === 'first-contentful-paint');
                    if (firstPaint) {
                        document.getElementById('paint-time').textContent = Math.round(firstPaint.startTime) + 'ms';
                    }
                }
            }
            
            // Update metrics when page loads
            if (document.readyState === 'complete') {
                updateMetrics();
            } else {
                window.addEventListener('load', updateMetrics);
            }
            
            // Update metrics periodically for dynamic values
            setTimeout(updateMetrics, 100);
            setTimeout(updateMetrics, 500);
        })();
    </script>
</body>
</html>
